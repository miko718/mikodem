# User Stories – אפליקציית Mikodem (מערכת תורים חכמה)

מסמך זה מכיל סיפורי משתמש מפורטים לשלב ה-MVP, בפורמט מוכן להעברה למפתח ולמעצב.

---

## רשימת תפקידים (Personas)

| תפקיד | תיאור |
|-------|--------|
| **לקוח (Client)** | אדם שמזמין תורים אצל עסקים (מספרה, ייעוץ, קליניקה וכו') |
| **בעל עסק (Business)** | מנהל עסק שמקבל תורים ומנהל זמינות |

---

## אפיק: התקנה והתחלה (First Launch)

### US-001: Splash Screen
**בתור** משתמש חדש שפתח את האפליקציה  
**אני רוצה** לראות מסך טעינה עם לוגו האפליקציה  
**כדי ש** אדע שהאפליקציה נטענת ויש לי חוויית כניסה מקצועית  

**קבלת קריטריונים:**
- [ ] הלוגו מוצג במרכז המסך
- [ ] משך הטעינה מינימלי (עד 2 שניות)
- [ ] מעבר אוטומטי ל-Onboarding (משתמש חדש) או ל-Dashboard (משתמש מחובר)

---

### US-002: Onboarding – מסכי הכרות
**בתור** משתמש חדש  
**אני רוצה** לעבור על 2–3 מסכי הסבר קצרים על האפליקציה  
**כדי ש** understood מה Mikodem מציעה ומה הערך שלה עבורי  

**קבלת קריטריונים:**
- [ ] 3 מסכים: "זמן תור בקלות" / "מעקב הגעה חכם" / "מעולם לא פיספסת תור"
- [ ] כפתור "דלג" (Skip) גלוי
- [ ] אינדיקטור דפים (נקודות או פסים)
- [ ] כפתור "התחל" במסך האחרון → מעבר להרשמה

---

### US-003: הרשמה עם Google
**בתור** משתמש חדש  
**אני רוצה** להירשם באמצעות חשבון Google שלי  
**כדי ש** אוכל להתחבר במהירות בלי למלא טופס ארוך  

**קבלת קריטריונים:**
- [ ] כפתור "המשך עם Google" בולט
- [ ] זיהוי אוטומטי של שם ואימייל
- [ ] יצירת רשומת User ב-Firestore עם role: `client`
- [ ] מעבר ל-Dashboard אחרי הרשמה מוצלחת

---

### US-004: התחברות עם OTP (אימות טלפוני)
**בתור** משתמש שמעדיף לא לחשוף Google  
**אני רוצה** להתחבר באמצעות מספר הטלפון שלי  
**כדי ש** אוכל לגשת לאפליקציה בצורה מאובטחת  

**קבלת קריטריונים:**
- [ ] שדה להזנת מספר טלפון
- [ ] שליחת קוד OTP (SMS)
- [ ] שדה להזנת קוד אימות
- [ ] תוקף קוד 5 דקות
- [ ] אופציה "שלח שוב" אחרי 60 שניות

---

## אפיק: קביעת תור (Booking Flow)

### US-005: בחירת שירות
**בתור** לקוח  
**אני רוצה** לראות רשימת שירותים שהעסק מציע  
**כדי ש** אוכל לבחור את השירות שאני צריך  

**קבלת קריטריונים:**
- [ ] רשימה נמשכת (scroll) של כרטיסיות שירות
- [ ] כל כרטיס מציג: שם שירות, משך זמן, מחיר
- [ ] לחיצה על כרטיס → מעבר לבחירת תאריך

---

### US-006: בחירת תאריך ושעה
**בתור** לקוח  
**אני רוצה** לבחור תאריך ושעה פנויה מתוך לוח השנה  
**כדי ש** אוכל לקבוע תור בהתאם לזמינות שלי ושל העסק  

**קבלת קריטריונים:**
- [ ] לוח שנה שבועי (או חודשי) – רק ימים שבהם העסק פעיל
- [ ] הצגת חלונות זמן פנויים לפי אלגוריתם זמינות
- [ ] התחשבות ב-`duration` של השירות וב-`bufferTime` של העסק
- [ ] סימון ויזואלי לשעות תפוסות vs פנויות
- [ ] לחיצה על שעה → מעבר למסך סיכום

---

### US-007: סיכום ואישור תור
**בתור** לקוח  
**אני רוצה** לראות סיכום של הפרטים לפני אישור סופי  
**כדי ש** אוכל לוודא שהכל נכון ולתקן אם צריך  

**קבלת קריטריונים:**
- [ ] הצגה: שירות, תאריך, שעה, משך, עסק
- [ ] שדות אופציונליים: הערות / בקשה מיוחדת
- [ ] כפתור "אשר תור"
- [ ] שמירה ל-Firestore באוסף `Appointments` עם status: `scheduled`
- [ ] מעבר למסך הצלחה (Success)

---

### US-008: מסך הצלחה
**בתור** לקוח  
**אני רוצה** לקבל אישור ויזואלי שהתור נקבע בהצלחה  
**כדי ש** ארגיש ביטחון ושאני יכול לסגור את האפליקציה  

**קבלת קריטריונים:**
- [ ] אייקון V גדול עם אנימציה
- [ ] טקסט "התור נקבע בהצלחה"
- [ ] פרטי התור (תאריך, שעה, מקום)
- [ ] כפתור "הוסף ליומן" – אינטגרציה ל-Device Calendar
- [ ] כפתור "חזרה לדף הבית"

---

## אפיק: דף הבית (Dashboard)

### US-009: התור הקרוב
**בתור** לקוח מחובר  
**אני רוצה** לראות בבירור את התור הקרוב שלי  
**כדי ש** אדע מתי לאן להגיע ומה השירות  

**קבלת קריטריונים:**
- [ ] כרטיס בולט עם: שם עסק, שירות, תאריך, שעה, כתובת
- [ ] כפתור "ניווט" (פתיחת מפות)
- [ ] מצב "אין תורים" עם כפתור "קבע תור"
- [ ] כפתור "+" צף לכניסה מהירה לקביעת תור חדש

---

### US-010: היסטוריית תורים
**בתור** לקוח  
**אני רוצה** לראות את התורים שעשיתי בעבר  
**כדי ש** אוכל לקבוע תור חוזר במהירות  

**קבלת קריטריונים:**
- [ ] רשימת תורים שעברו (מיון לפי תאריך יורד)
- [ ] כל תור: עסק, שירות, תאריך
- [ ] כפתור "קבע שוב" – מעבר לבחירת שירות באותו עסק
- [ ] גלילה אינסופית או pagination

---

## אפיק: מעקב הגעה (ETA & Smart Swap)

### US-011: עדכון מיקום (רקע)
**בתור** לקוח עם תור קרוב  
**אני רוצה** שהאפליקציה תעקוב אחרי המיקום שלי (ברקע)  
**כדי ש** העסק יידע מתי בערך אני מגיע  

**קבלת קריטריונים:**
- [ ] בקשת הרשאות Location (Foreground + Background)
- [ ] עדכון `lastLocation` ב-Firestore (Users) כל 5–10 דקות כשמתקרבים לזמן התור
- [ ] Cloud Function `updateETA` מחשבת זמן הגעה משוער → מעדכנת `currentETA` ב-Appointments

---

### US-012: התראה לפני התור
**בתור** לקוח  
**אני רוצה** לקבל התראה Push כשעה לפני התור שלי  
**כדי ש** לא אשכח ואגיע בזמן  

**קבלת קריטריונים:**
- [ ] הרשמה ל-FCM ושמירת `fcmToken` ב-Users
- [ ] Cloud Function (scheduled) שולחת התראה 60 דקות לפני `startTime`
- [ ] תוכן ההתראה: "תור ב-[שם עסק] בשעה [שעה] – אל תשכח!"

---

### US-013: התראה על איחור
**בתור** לקוח שמאחר  
**אני רוצה** לקבל התראה כשהמערכת מזהה שאני עלול לאחר  
**כדי ש** אוכל לנסות להגיע מהר יותר או ליידע את העסק  

**קבלת קריטריונים:**
- [ ] Cloud Function `checkDelay` מזהה `currentETA > startTime + 10 דקות`
- [ ] עדכון `isLate: true`, `status: delayed`
- [ ] התראה Push ללקוח: "נראה שאתה מאחר לתור – יש אפשרות להחליף?"
- [ ] (אופציונלי) כפתור "אשר החלפה" אם נמצא מועמד

---

### US-014: החלפת תור אוטומטית (בעל עסק)
**בתור** בעל עסק עם `autoSwap: true`  
**אני רוצה** שהמערכת תמצא אוטומטית לקוח קרוב שיכול להחליף תור  
**כדי ש** אוכל לנצל את הזמן ביעילות כשמישהו מאחר  

**קבלת קריטריונים:**
- [ ] Cloud Function `findSwapCandidate` רצה כש-`isLate: true`
- [ ] חיפוש תור מאוחר יותר באותו עסק
- [ ] בדיקה ש-`lastLocation` של הלקוח המאוחר קרוב לעסק (רדיוס ~2 ק"מ)
- [ ] החלפת `startTime` בין שני התורים
- [ ] שליחת התראות לשני הלקוחות על השינוי

---

## אפיק: חיפוש וסינון

### US-015: חיפוש עסקים
**בתור** לקוח  
**אני רוצה** לחפש עסקים לפי שם, קטגוריה או מיקום  
**כדי ש** אמצא בקלות את העסק שאני צריך  

**קבלת קריטריונים:**
- [ ] שדה חיפוש (Search Bar)
- [ ] סינון לפי קטגוריה (dropdown או chips)
- [ ] "לידי" – מיון לפי מרחק (GeoHash / GeoQuery)
- [ ] רשימת תוצאות בכרטיסיות

---

### US-016: מסך פרטי עסק
**בתור** לקוח  
**אני רוצה** לראות פרטים מלאים על עסק לפני שאקבע תור  
**כדי ש** אדע מה הוא מציע, איפה הוא ואיך ליצור קשר  

**קבלת קריטריונים:**
- [ ] שם העסק, קטגוריה, כתובת
- [ ] כפתור "ניווט" (Waze/Google Maps)
- [ ] כפתור "התקשר"
- [ ] רשימת שירותים עם מחירים ומשכי זמן
- [ ] כפתור "קבע תור" → US-005

---

## אפיק: אזור אישי והגדרות

### US-017: פרופיל משתמש
**בתור** משתמש מחובר  
**אני רוצה** לערוך את הפרטים שלי  
**כדי ש** המידע יהיה עדכני ורלוונטי  

**קבלת קריטריונים:**
- [ ] הצגת: שם, אימייל/טלפון, תמונה (אם קיימת)
- [ ] כפתור "ערוך פרטים" – טופס לעדכון
- [ ] שמירה ל-Firestore (Users)

---

### US-018: מסך התראות
**בתור** משתמש  
**אני רוצה** לראות היסטוריית התראות ועדכונים  
**כדי ש** אוכל לעקוב אחרי מה שקרה  

**קבלת קריטריונים:**
- [ ] רשימת התראות (תור נקבע, תזכורת, איחור, החלפת תור)
- [ ] תאריך ושעה לכל התראה
- [ ] סימון "נקרא" / "לא נקרא"
- [ ] ריקון כשהמשתמש סימן כנקרא

---

### US-019: התנתקות
**בתור** משתמש מחובר  
**אני רוצה** להתנתק מהאפליקציה  
**כדי ש** אוכל להחליף חשבון או להשאיר את המכשיר לאחר  

**קבלת קריטריונים:**
- [ ] כפתור "התנתק" באזור הפרופיל/הגדרות
- [ ] אימות (אופציונלי): "האם אתה בטוח?"
- [ ] ניקוי session ומעבר למסך ההתחברות

---

## אפיק: מצבי קצה (Edge Cases)

### US-020: אין חיבור לאינטרנט
**בתור** משתמש  
**אני רוצה** לראות הודעה ברורה כשאין חיבור  
**כדי ש** אבין שזה לא באג באפליקציה  

**קבלת קריטריונים:**
- [ ] מסך/באנר "אין חיבור לאינטרנט"
- [ ] כפתור "נסה שוב"
- [ ] זיהוי חיבור מחודש → רענון אוטומטי

---

### US-021: אין תורים פנויים
**בתור** לקוח  
**אני רוצה** לראות הודעה ברורה כשאין זמינות בתאריך שבחרתי  
**כדי ש** אדע לנסות תאריך אחר  

**קבלת קריטריונים:**
- [ ] טקסט "אין תורים פנויים בתאריך זה"
- [ ] כפתור "בחר תאריך אחר"
- [ ] (אופציונלי) הצעת ימים סמוכים עם זמינות

---

*מסמך זה משלים את SPRINT_PLAN.md, FIRESTORE_SCHEMA.md ותוכנית המסכים – ומוכן להעברה לצוות הפיתוח והעיצוב.*

**עודכן: פברואר 2025**
